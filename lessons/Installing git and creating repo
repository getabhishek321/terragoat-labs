# Setup log — Git, git-lfs, gh, and repo creation (detailed)

> Purpose: a reproducible record of the steps taken to install and verify Git tooling, fix a broken script, and scaffold + push the `terragoat-labs` repository. 
Use this as your future reference.

--- 

## Environment

* Host: Ubuntu (Linux VM) — commands run in a bash shell.
* Working folder used: `~/projects`
* Repo name used in the script: `terragoat-labs`
* Tools used (installed or checked): `git`, `git-lfs`, `gh` (GitHub CLI), Bash.

---

## 1 — Basic checks (what I ran first)

Open a terminal and run these to check presence and versions of core tools:


git --version 
gh --version || echo "gh not installed"
git-lfs --version || echo "git-lfs not installed"
bash --version


**Why:** verifies you have the tools required. If any are missing, the subsequent installation steps are needed.

**Expected example outputs:**

* `git --version` → `git version 2.34.1` (versions vary)
* `gh --version` → `gh version 2.x.x`
* `git-lfs --version` → `git-lfs/3.x.x (GitHub; linux amd64; go1.x)`
* `bash --version` → `GNU bash, version 5.x.x(...)`

---

## 2 — Installing missing tools (if needed)

### Install Git (Debian/Ubuntu)


sudo apt update
sudo apt install -y git


### Install GitHub CLI (`gh`) — recommended install for Debian/Ubuntu


sudo apt install -y curl apt-transport-https
curl -fsSL https://cli.github.com/packages/githubcli-archive-keyring.gpg | sudo dd of=/usr/share/keyrings/githubcli-archive-keyring.gpg
sudo chmod go+r /usr/share/keyrings/githubcli-archive-keyring.gpg
echo "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/githubcli-archive-keyring.gpg] https://cli.github.com/packages stable main" |
  sudo tee /etc/apt/sources.list.d/github-cli.list > /dev/null
sudo apt update
sudo apt install -y gh


### Install Git LFS


curl -s https://packagecloud.io/install/repositories/github/git-lfs/script.deb.sh | sudo bash
sudo apt install -y git-lfs
git lfs install


**Why:** `gh` lets us create GitHub repos and perform common actions from CLI; `git-lfs` avoids large-binary problems when storing screenshots.

---

## 3 — Create working folder and prepare to scaffold

Create a projects folder and change into it:


mkdir -p ~/projects
cd ~/projects
pwd   # should show /home/<user>/projects


---

## 4 — The broken script warning and diagnosis

When you first ran the script you saw:


./create_repo.sh: line 106: warning: here-document at line 82 delimited by end-of-file (wanted `EOF')


**Meaning:** one or more here-doc (`cat > file <<'EOF' ... EOF`) blocks were not closed with their matching `EOF`. This usually happens if the script was partially pasted or truncated.

**Quick diagnostics used (optional):**


# show end of file
tail -n 120 create_repo.sh

# show file with line numbers
nl -ba create_repo.sh | sed -n '1,300p'


Look for `<<'EOF'` lines that do not have a later `EOF` terminator.

---

## 5 — Back up the broken script (safety)

Always back up before overwriting:


cp create_repo.sh create_repo.sh.bak.$(date +%s)


This creates a timestamped backup like `create_repo.sh.bak.1700000000`.

---

## 6 — Replace the broken script with a corrected version (what we did)

We replaced the script safely by writing a fixed `create_repo.sh` file with a here-document that contains the full scaffold script. Example command used:


cat > create_repo.sh <<'SCRIPT'
#!/usr/bin/env bash
# create_repo.sh
# ... entire corrected script content follows ...
SCRIPT


Then make it executable:


chmod +x create_repo.sh


**Why:** this ensures the file is atomically rewritten and the here-document markers are correct.

---

## 7 — Run the create script

From `~/projects`:


./create_repo.sh


**What the script does (summary):**

* Creates directory `./terragoat-labs`.
* Creates folders: `.github/ISSUE_TEMPLATE`, `.github/workflows`, `labs`, `diary`, `lessons`, `scripts`, `screenshots`.
* Writes scaffold files: `.gitignore`, `.gitattributes`, `README.md`, lab templates, issue templates, workflow, diary template, lessons/README.
* `git init`, initial commit.
* If `git-lfs` present: `git lfs install`, `git lfs track "**/screenshots/*"`, commit `.gitattributes`.
* If `gh` present and you're authenticated: create GitHub repository with `gh repo create ... --source=. --remote=origin --push`.
* If `gh` missing: prints manual instructions to add a remote and push.

**Typical outputs / prompts:**

* If `gh` creates the repo, it will show a created repo URL and automatically push `main`.
* If `git-lfs` is missing, the script prints a reminder to install it.

---

## 8 — If `gh` is used: authenticate `gh` before running

If `gh` is installed but not logged in:


gh auth login


Follow the interactive prompts:

* Choose GitHub.com
* Choose a preferred authentication method (browser recommended)
* Approve requested scopes (repo creation needs `repo` or relevant scopes)

**Tip:** confirm login with:


gh auth status


---

## 9 — Manual push alternative (if gh not used or failed)

If you prefer to create the repo through GitHub web UI, or `gh` failed, follow these steps:

1. Create a GitHub repo named `terragoat-labs` (via web UI).
2. In your local `~/projects/terragoat-labs` run:


git branch -M main
git remote add origin git@github.com:YOUR_USERNAME/terragoat-labs.git
git push -u origin main


If you use HTTPS remote instead of SSH:


git remote add origin https://github.com/YOUR_USERNAME/terragoat-labs.git
git push -u origin main


If prompted for credentials when pushing via HTTPS, either:

* Use `gh auth login` which configures credential helpers, or
* Set up SSH keys and add them to GitHub (see below).

---

## 10 — (Optional but recommended) Set up SSH keys for GitHub pushes


# generate a key (if you don't have one)
ssh-keygen -t ed25519 -C "your_email@example.com"
# or for older systems:
# ssh-keygen -t rsa -b 4096 -C "your_email@example.com"

# copy public key
cat ~/.ssh/id_ed25519.pub   # copy this and paste into GitHub > Settings > SSH and GPG keys

# test
ssh -T git@github.com
# expected: "Hi <username>! You've successfully authenticated, but GitHub does not provide shell access."


---

## 11 — Confirm repository & tracking status (verification commands)

Run these in the project folder to confirm everything is correct:


# check git repo
git status
git log --oneline -n 5

# check remote
git remote -v

# check LFS tracking
git lfs track
git lfs ls-files  # lists LFS tracked files in the working tree

# check gh connection (if using gh)
gh repo view --web  # opens repo in browser
gh auth status

# check files created
ls -la
tree -L 2   # if tree is installed


**What to see:**

* `git status` should show a clean working tree right after the initial commit.
* `git remote -v` should show `origin` with the repo URL (if pushed).
* `.gitattributes` should contain LFS patterns for `**/screenshots/*`.

---
